<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Infinite Platformer</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #111;
      touch-action: none;
    }
    canvas {
      display: block;
      width: 100vw;
      height: 100vh;
    }
    .controls {
      position: absolute;
      bottom: 10px;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 20px;
    }
    .btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      border: 2px solid #fff;
      color: white;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
    }
  </style>
</head>
<body>
<canvas id="game"></canvas>
<div class="controls">
  <div class="btn" id="left">⬅</div>
  <div class="btn" id="jump">⬆</div>
  <div class="btn" id="right">➡</div>
</div>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const keys = { left: false, right: false, jump: false };
let levelIndex = 0;

const player = {
  x: 100, y: 100, w: 40, h: 40,
  vx: 0, vy: 0, speed: 5, jumping: false,
  baseSpeed: 5
};

const gravity = 0.5;
let platforms = [], coins = [], enemies = [], powerUps = [];

// Sounds
const sfx = {
  jump: new Audio('https://cdn.pixabay.com/audio/2021/08/04/audio_304c4d2821.mp3'),
  coin: new Audio('https://cdn.pixabay.com/audio/2022/03/10/audio_74e9576b22.mp3'),
  hit: new Audio('https://cdn.pixabay.com/audio/2021/08/04/audio_dbf6eb77be.mp3'),
  win: new Audio('https://cdn.pixabay.com/audio/2022/03/15/audio_b9c9dbe7e3.mp3')
};

function resetPlayer() {
  player.x = 100;
  player.y = 100;
  player.vx = 0;
  player.vy = 0;
  player.speed = player.baseSpeed;
}

function spawnLevel(index) {
  platforms = [];
  coins = [];
  enemies = [];
  powerUps = [];

  let spacing = 250;
  for (let i = 0; i < 5 + index; i++) {
    let x = 150 * i + 100;
    let y = canvas.height - (Math.random() * 200 + 100);
    platforms.push({ x, y, w: 150, h: 20 });
    if (Math.random() < 0.7) coins.push({ x: x + 60, y: y - 30, collected: false });
    if (Math.random() < 0.3) enemies.push({ x: x + 50, y: y - 40, w: 40, h: 40, dir: 1, speed: 2, range: [x + 30, x + 120] });
    if (Math.random() < 0.2) powerUps.push({ x: x + 80, y: y - 20, used: false });
  }
  platforms.push({ x: 0, y: canvas.height - 40, w: canvas.width, h: 40 });
}

function update() {
  player.vx = 0;
  if (keys.left) player.vx = -player.speed;
  if (keys.right) player.vx = player.speed;

  player.vy += gravity;
  player.x += player.vx;
  player.y += player.vy;

  let onGround = false;
  for (let p of platforms) {
    if (
      player.x < p.x + p.w &&
      player.x + player.w > p.x &&
      player.y + player.h < p.y + player.vy &&
      player.y + player.h + player.vy > p.y
    ) {
      player.vy = 0;
      player.y = p.y - player.h;
      onGround = true;
      player.jumping = false;
    }
  }

  if (keys.jump && !player.jumping && onGround) {
    player.vy = -12;
    player.jumping = true;
    sfx.jump.play();
  }

  // Coin collection
  for (let coin of coins) {
    if (!coin.collected && player.x < coin.x + 20 && player.x + player.w > coin.x && player.y < coin.y + 20 && player.y + player.h > coin.y) {
      coin.collected = true;
      sfx.coin.play();
    }
  }

  // Enemy collision
  for (let enemy of enemies) {
    enemy.x += enemy.dir * enemy.speed;
    if (enemy.x < enemy.range[0] || enemy.x > enemy.range[1]) enemy.dir *= -1;
    if (
      player.x < enemy.x + enemy.w &&
      player.x + player.w > enemy.x &&
      player.y < enemy.y + enemy.h &&
      player.y + player.h > enemy.y
    ) {
      resetPlayer();
      sfx.hit.play();
    }
  }

  // Power-up
  for (let pu of powerUps) {
    if (!pu.used && player.x < pu.x + 20 && player.x + player.w > pu.x && player.y < pu.y + 20 && player.y + player.h > pu.y) {
      pu.used = true;
      player.speed = 10;
      setTimeout(() => player.speed = player.baseSpeed, 3000);
    }
  }

  // Infinite level progression
  if (coins.every(c => c.collected)) {
    levelIndex++;
    sfx.win.play();
    spawnLevel(levelIndex);
    resetPlayer();
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = '#61dafb';
  ctx.fillRect(player.x, player.y, player.w, player.h);

  ctx.fillStyle = '#fff';
  for (let p of platforms) ctx.fillRect(p.x, p.y, p.w, p.h);

  ctx.fillStyle = 'gold';
  for (let coin of coins) if (!coin.collected) ctx.fillRect(coin.x, coin.y, 20, 20);

  ctx.fillStyle = 'red';
  for (let enemy of enemies) ctx.fillRect(enemy.x, enemy.y, enemy.w, enemy.h);

  ctx.fillStyle = 'lime';
  for (let pu of powerUps) if (!pu.used) ctx.fillRect(pu.x, pu.y, 20, 20);

  ctx.fillStyle = '#fff';
  ctx.font = '16px sans-serif';
  ctx.fillText('Level: ' + (levelIndex + 1), 10, 20);
}

function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

spawnLevel(levelIndex);
gameLoop();

// Controls
['left','right','jump'].forEach(id => {
  document.getElementById(id).ontouchstart = () => keys[id] = true;
  document.getElementById(id).ontouchend = () => keys[id] = false;
});

window.addEventListener('keydown', e => {
  if (e.key === 'ArrowLeft') keys.left = true;
  if (e.key === 'ArrowRight') keys.right = true;
  if (e.key === 'ArrowUp') keys.jump = true;
});
window.addEventListener('keyup', e => {
  if (e.key === 'ArrowLeft') keys.left = false;
  if (e.key === 'ArrowRight') keys.right = false;
  if (e.key === 'ArrowUp') keys.jump = false;
});
</script>
</body>
</html>
